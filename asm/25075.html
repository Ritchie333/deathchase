<!DOCTYPE html>
<html>
<head>
<title>Deathchase: Routine at 61F3</title>
<meta charset="utf-8" />
<link rel="stylesheet" type="text/css" href="../skoolkit.css" />

</head>
<body class="Asm-c">
<table class="header">
<tr>
<td class="logo"><a href="../index.html">Deathchase</a></td>
<td class="page-header">Routines</td>
</tr>
</table>
<table class="asm-navigation">
<tr>
<td class="prev"><span class="prev-1">Prev: <a href="24912.html">6150</a></span></td>
<td class="up">Up: <a href="../maps/all.html#25075">Map</a></td>
<td class="next"><span class="next-1">Next: <a href="25229.html">628D</a></span></td>
</tr>
</table>
<div class="description">61F3: Recalculate where the enemy bikes should be</div>
<table class="disassembly">
<tr>
<td class="routine-comment" colspan="4">
<div class="details">
<div class="paragraph">
Used by the routine at <a href="26173.html">663D</a>.
</div>
</div>
<table class="input-0">
<tr class="asm-input-header">
<th colspan="2">Input</th>
</tr>

</table>
<table class="output-0">
<tr class="asm-output-header">
<th colspan="2">Output</th>
</tr>

</table>
</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><span id="25075"></span>61F3</td>
<td class="instruction">LD A,($5DC8)</td>
<td class="comment-11" rowspan="1">See what enemy bikes are still in play</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="25078"></span>61F6</td>
<td class="instruction">BIT 0,A</td>
<td class="comment-11" rowspan="1">Is enemy bike 1 running?</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="25080"></span>61F8</td>
<td class="instruction">JR NZ,$61FF</td>
<td class="comment-11" rowspan="1">Jump forward if it is</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><span id="25082"></span>61FA</td>
<td class="instruction">BIT 1,A</td>
<td class="comment-11" rowspan="1">Is enemy bike 2 running?</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="25084"></span>61FC</td>
<td class="instruction">JR NZ,$6221</td>
<td class="comment-11" rowspan="1">Jump forward if it is</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="25086"></span>61FE</td>
<td class="instruction">RET</td>
<td class="comment-11" rowspan="1">No bikes, nothing to do</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><span id="25087"></span>61FF</td>
<td class="instruction">LD HL,$5DC8</td>
<td class="comment-11" rowspan="1">Set bit 3 to denote more work to do</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="25090"></span>6202</td>
<td class="instruction">SET 3,(HL)</td>
<td class="comment-11" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="25092"></span>6204</td>
<td class="instruction">LD HL,$5DC6</td>
<td class="comment-11" rowspan="1">Modify the checking code to work with bike 1</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="25095"></span>6207</td>
<td class="instruction">LD ($6244),HL</td>
<td class="comment-11" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="25098"></span>620A</td>
<td class="instruction">LD ($6262),HL</td>
<td class="comment-11" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="25101"></span>620D</td>
<td class="instruction">LD HL,$5DC4</td>
<td class="comment-11" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="25104"></span>6210</td>
<td class="instruction">LD ($6253),HL</td>
<td class="comment-11" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="25107"></span>6213</td>
<td class="instruction">LD ($6282),HL</td>
<td class="comment-11" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="25110"></span>6216</td>
<td class="instruction">LD HL,$5DC2</td>
<td class="comment-11" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="25113"></span>6219</td>
<td class="instruction">LD ($6265),HL</td>
<td class="comment-11" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="25116"></span>621C</td>
<td class="instruction">LD ($6278),HL</td>
<td class="comment-11" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="25119"></span>621F</td>
<td class="instruction">JR $6243</td>
<td class="comment-11" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><span id="25121"></span>6221</td>
<td class="instruction">LD HL,$5DC8</td>
<td class="comment-11" rowspan="1">Flag as no more bike checking to do after this</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="25124"></span>6224</td>
<td class="instruction">RES 3,(HL)</td>
<td class="comment-11" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="25126"></span>6226</td>
<td class="instruction">LD HL,$5DC7</td>
<td class="comment-11" rowspan="1">Modify the checking code to work with bike 2</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="25129"></span>6229</td>
<td class="instruction">LD ($6244),HL</td>
<td class="comment-11" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="25132"></span>622C</td>
<td class="instruction">LD ($6262),HL</td>
<td class="comment-11" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="25135"></span>622F</td>
<td class="instruction">LD HL,$5DC5</td>
<td class="comment-11" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="25138"></span>6232</td>
<td class="instruction">LD ($6253),HL</td>
<td class="comment-11" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="25141"></span>6235</td>
<td class="instruction">LD ($6282),HL</td>
<td class="comment-11" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="25144"></span>6238</td>
<td class="instruction">LD HL,$5DC3</td>
<td class="comment-11" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="25147"></span>623B</td>
<td class="instruction">LD ($6265),HL</td>
<td class="comment-11" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="25150"></span>623E</td>
<td class="instruction">LD ($6278),HL</td>
<td class="comment-11" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="25153"></span>6241</td>
<td class="instruction">JR $6243</td>
<td class="comment-11" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><span id="25155"></span>6243</td>
<td class="instruction">LD A,($5DC6)</td>
<td class="comment-11" rowspan="1">Get the bike's position</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="25158"></span>6246</td>
<td class="instruction">CP $C8</td>
<td class="comment-11" rowspan="1">Is it below -38?</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="25160"></span>6248</td>
<td class="instruction">JR C,$624C</td>
<td class="comment-11" rowspan="1">Jump if not</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="25162"></span>624A</td>
<td class="instruction">LD A,$00</td>
<td class="comment-11" rowspan="1">... otherwise reset to 0</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><span id="25164"></span>624C</td>
<td class="instruction">CP $21</td>
<td class="comment-11" rowspan="1">Is it above 21?</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="25166"></span>624E</td>
<td class="instruction">JR C,$6252</td>
<td class="comment-11" rowspan="1">Jump if not</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="25168"></span>6250</td>
<td class="instruction">LD A,$20</td>
<td class="comment-11" rowspan="1">... otherwise reset to 20</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><span id="25170"></span>6252</td>
<td class="instruction">LD HL,$5DC4</td>
<td class="comment-11" rowspan="2">Get the position to change the bike by and adjust it</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="25173"></span>6255</td>
<td class="instruction">ADD A,(HL)</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="25174"></span>6256</td>
<td class="instruction">LD HL,$5DE8</td>
<td class="comment-11" rowspan="1">Is the bike moving?</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="25177"></span>6259</td>
<td class="instruction">BIT 0,(HL)</td>
<td class="comment-11" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="25179"></span>625B</td>
<td class="instruction">JR Z,$6261</td>
<td class="comment-11" rowspan="1">Jump forward if it isn't</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="25181"></span>625D</td>
<td class="instruction">LD HL,$5DDF</td>
<td class="comment-11" rowspan="1">Adjust the enemy bike position to suit our next position</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="25184"></span>6260</td>
<td class="instruction">SUB (HL)</td>
<td class="comment-11" rowspan="1">if we are turning left or right</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><span id="25185"></span>6261</td>
<td class="instruction">LD ($5DC6),A</td>
<td class="comment-11" rowspan="1">Store new bike position</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="25188"></span>6264</td>
<td class="instruction">LD HL,$5DC2</td>
<td class="comment-11" rowspan="1">Get the number of frames before bike should turn</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="25191"></span>6267</td>
<td class="instruction">DEC (HL)</td>
<td class="comment-11" rowspan="1">Decrement it</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="25192"></span>6268</td>
<td class="instruction">XOR A</td>
<td class="comment-11" rowspan="1">Is it 0?</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="25193"></span>6269</td>
<td class="instruction">CP (HL)</td>
<td class="comment-11" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="25194"></span>626A</td>
<td class="instruction">JR NZ,$6284</td>
<td class="comment-11" rowspan="1">Jump forward if it isn't</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="25196"></span>626C</td>
<td class="instruction">CALL <a href="25745.html">$6491</a></td>
<td class="comment-11" rowspan="1">Get a random number</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="25199"></span>626F</td>
<td class="instruction">AND $1C</td>
<td class="comment-11" rowspan="1">Take bits 2-4 and store it in B plus 1</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="25201"></span>6271</td>
<td class="instruction">SRL A</td>
<td class="comment-11" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="25203"></span>6273</td>
<td class="instruction">SRL A</td>
<td class="comment-11" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="25205"></span>6275</td>
<td class="instruction">LD B,A</td>
<td class="comment-11" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="25206"></span>6276</td>
<td class="instruction">INC B</td>
<td class="comment-11" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="25207"></span>6277</td>
<td class="instruction">LD HL,$5DC2</td>
<td class="comment-11" rowspan="1">Repopulate the frame counter</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="25210"></span>627A</td>
<td class="instruction">LD (HL),B</td>
<td class="comment-11" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="25211"></span>627B</td>
<td class="instruction">AND $03</td>
<td class="comment-11" rowspan="1">If all bits are set, don't change direction</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="25213"></span>627D</td>
<td class="instruction">CP $03</td>
<td class="comment-11" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="25215"></span>627F</td>
<td class="instruction">RET Z</td>
<td class="comment-11" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="25216"></span>6280</td>
<td class="instruction">DEC A</td>
<td class="comment-11" rowspan="1">Adjust the bike's position</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="25217"></span>6281</td>
<td class="instruction">LD ($5DC4),A</td>
<td class="comment-11" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><span id="25220"></span>6284</td>
<td class="instruction">LD A,($5DC8)</td>
<td class="comment-11" rowspan="1">Is there another bike to look at?</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="25223"></span>6287</td>
<td class="instruction">BIT 3,A</td>
<td class="comment-11" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="25225"></span>6289</td>
<td class="instruction">JP NZ,$61FA</td>
<td class="comment-11" rowspan="1">Go back and adjust that if so</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="25228"></span>628C</td>
<td class="instruction">RET</td>
<td class="comment-11" rowspan="1">Otherwise all done</td>
</tr>
</table>
<table class="asm-navigation">
<tr>
<td class="prev"><span class="prev-1">Prev: <a href="24912.html">6150</a></span></td>
<td class="up">Up: <a href="../maps/all.html#25075">Map</a></td>
<td class="next"><span class="next-1">Next: <a href="25229.html">628D</a></span></td>
</tr>
</table>
<footer>
<div class="release"></div>
<div class="copyright">Copyright Mervyn Estcourt 1983. This disassembly by Ritchie Swann, 2018.</div>
<div class="created">Created using <a href="http://skoolkit.ca/">SkoolKit</a> 7.0.</div>
</footer>
</body>
</html>