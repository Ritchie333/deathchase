<!DOCTYPE html>
<html>
<head>
<title>Deathchase: Routine at 6B96</title>
<meta charset="utf-8" />
<link rel="stylesheet" type="text/css" href="../skoolkit.css" />

</head>
<body class="Asm-c">
<table class="header">
<tr>
<td class="logo"><a href="../index.html">Deathchase</a></td>
<td class="page-header">Routines</td>
</tr>
</table>
<table class="asm-navigation">
<tr>
<td class="prev"><span class="prev-1">Prev: <a href="27519.html">6B7F</a></span></td>
<td class="up">Up: <a href="../maps/all.html#27542">Map</a></td>
<td class="next"><span class="next-1">Next: <a href="27594.html">6BCA</a></span></td>
</tr>
</table>
<div class="description">6B96: Save the game to tape if bit 0 in 5DEB is reset and P is held down, then S is pressed</div>
<table class="disassembly">
<tr>
<td class="routine-comment" colspan="4">
<div class="details">
<div class="paragraph">
Used by the routine at <a href="25983.html">657F</a>.
</div>
</div>
<table class="input-0">
<tr class="asm-input-header">
<th colspan="2">Input</th>
</tr>

</table>
<table class="output-0">
<tr class="asm-output-header">
<th colspan="2">Output</th>
</tr>

</table>
</td>
</tr>
<tr>
<td class="routine-comment" colspan="4">
<span id="27542"></span>
<div class="comments">
<div class="paragraph">
This routine saves the state of the execution of the game's main BASIC, which is used immediately after the loading routine is executed. The RET at the end returns to BASIC, which is positioned at a "GOTO 1" statement that re-runs a program. The loading system picks up the system variables to match this state, which allows the game to start when it's loaded.
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><span id="27542"></span>6B96</td>
<td class="instruction">EX AF,AF'</td>
<td class="comment-11" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="27543"></span>6B97</td>
<td class="instruction">LD A,$03</td>
<td class="comment-11" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="27545"></span>6B99</td>
<td class="instruction">EX AF,AF'</td>
<td class="comment-11" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="27546"></span>6B9A</td>
<td class="instruction">POP HL</td>
<td class="comment-11" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="27547"></span>6B9B</td>
<td class="instruction">CALL <a href="24746.html">$60AA</a></td>
<td class="comment-11" rowspan="1">Play an ascending sound</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="27550"></span>6B9E</td>
<td class="instruction">CALL <a href="27519.html">$6B7F</a></td>
<td class="comment-11" rowspan="1">Play a descending sound</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="27553"></span>6BA1</td>
<td class="instruction">LD A,$FE</td>
<td class="comment-11" rowspan="1">Check that "Z" is held down</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="27555"></span>6BA3</td>
<td class="instruction">IN A,($FE)</td>
<td class="comment-11" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="27557"></span>6BA5</td>
<td class="instruction">BIT 1,A</td>
<td class="comment-11" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="27559"></span>6BA7</td>
<td class="instruction">JR Z,$6BAE</td>
<td class="comment-11" rowspan="1">Jump forward if so</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="27561"></span>6BA9</td>
<td class="instruction">LD A,$01</td>
<td class="comment-11" rowspan="1">Unset "save game to tape" flag</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="27563"></span>6BAB</td>
<td class="instruction">LD ($5DEB),A</td>
<td class="comment-11" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><span id="27566"></span>6BAE</td>
<td class="instruction">LD A,$DF</td>
<td class="comment-11" rowspan="1">Check that "P" is held down</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="27568"></span>6BB0</td>
<td class="instruction">IN A,($FE)</td>
<td class="comment-11" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="27570"></span>6BB2</td>
<td class="instruction">BIT 0,A</td>
<td class="comment-11" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="27572"></span>6BB4</td>
<td class="instruction">RET NZ</td>
<td class="comment-11" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><span id="27573"></span>6BB5</td>
<td class="instruction">LD A,$FD</td>
<td class="comment-11" rowspan="4">Wait for "S" to be pressed</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="27575"></span>6BB7</td>
<td class="instruction">IN A,($FE)</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="27577"></span>6BB9</td>
<td class="instruction">BIT 1,A</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="27579"></span>6BBB</td>
<td class="instruction">JR NZ,$6BB5</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="27581"></span>6BBD</td>
<td class="instruction">LD A,$FF</td>
<td class="comment-11" rowspan="1">Flag for headerless data block</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="27583"></span>6BBF</td>
<td class="instruction">LD IX,$4000</td>
<td class="comment-11" rowspan="1">Start address</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="27587"></span>6BC3</td>
<td class="instruction">LD DE,$3F48</td>
<td class="comment-11" rowspan="1">Length</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="27590"></span>6BC6</td>
<td class="instruction">CALL $04C2</td>
<td class="comment-11" rowspan="1">SA-BYTES</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><span id="27593"></span>6BC9</td>
<td class="instruction">RET</td>
<td class="comment-11" rowspan="1">Exit to BASIC.</td>
</tr>
</table>
<table class="asm-navigation">
<tr>
<td class="prev"><span class="prev-1">Prev: <a href="27519.html">6B7F</a></span></td>
<td class="up">Up: <a href="../maps/all.html#27542">Map</a></td>
<td class="next"><span class="next-1">Next: <a href="27594.html">6BCA</a></span></td>
</tr>
</table>
<footer>
<div class="release"></div>
<div class="copyright">Copyright Mervyn Estcourt 1983. This disassembly by Ritchie Swann, 2018.</div>
<div class="created">Created using <a href="http://skoolkit.ca/">SkoolKit</a> 7.0.</div>
</footer>
</body>
</html>